/*
 * jQuery Booklet Plugin
 * Copyright (c) 2010 - 2012 W. Grauvogel (http://builtbywill.com/)
 *
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version : 1.3.0
 *
 * Originally based on the work of:
 *	1) Charles Mangin (http://clickheredammit.com/pageflip/)
 */
;(function(a){a.fn.booklet=function(c){return a(this).each(function(){var g,e,f,d;if(typeof c=="string"){if(a(this).data("booklet")){g=c.toLowerCase();f=a(this).data("booklet");if(g=="next"){f.next()}else{if(g=="prev"){f.prev()}}}}else{if(typeof c=="number"){if(a(this).data("booklet")){d=c;f=a(this).data("booklet");if(d%2!=0){d-=1}if(f.options.direction=="RTL"){d=Math.abs(d-f.options.pageTotal)-2}f.goToPage(d)}}else{e=a.extend({},a.fn.booklet.defaults,c);f=new b(a(this),e);f.init();return this}}})};function b(aE,ay){var ad=aE;var ag=ay;var R=false;var L=false;var an=false;var c=false;var am=false;var k={empty:'<div class="b-page-empty" title=""></div>',blank:'<div class="b-page-blank" title=""></div>'};var ai={leftToRight:"LTR",rightToLeft:"RTL"};var N="",W="/page/",M,I,G,K,Q,s,E,ac,aa,Z,Y,V,aC,ak,H,w,d,az,av,aB,aD,ah,o,af,ax,ap,v,au,at,O,ar,aq,r,D,C,B,A,f,e,q;var p=new Array();function g(h,aG,aF){var j="";var aH="";var i;if(h.attr("rel")){j=h.attr("rel")}if(h.attr("title")){aH=h.attr("title")}if(h.hasClass("b-page-empty")){h.wrap('<div class="b-page"><div class="b-wrap"></div></div>')}else{if(aF.closed&&aF.covers&&(aG==1||aG==aF.pageTotal-2)){h.wrap('<div class="b-page"><div class="b-wrap b-page-cover"></div></div>')}else{if(aG%2!=0){h.wrap('<div class="b-page"><div class="b-wrap b-wrap-right"></div></div>')}else{h.wrap('<div class="b-page"><div class="b-wrap b-wrap-left"></div></div>')}}}i=h.parents(".b-page").addClass("b-page-"+aG);if(aF.pageNumbers&&!h.hasClass("b-page-empty")&&(!aF.closed||(aF.closed&&!aF.covers)||(aF.closed&&aF.covers&&aG!=1&&aG!=aF.pageTotal-2))){if(aF.direction==ai.leftToRight){aF.startingPageNumber++}h.parent().append('<div class="b-counter">'+aF.startingPageNumber+"</div>");if(aF.direction==ai.rightToLeft){aF.startingPageNumber--}}return{index:aG,contentNode:h,pageNode:i,chapter:j,title:aH}}var al=function(){if(!R){a(".b-load").children().unwrap();ad.addClass("booklet");ad.data("booklet",this);ad.data("total",ad.children().length);ag.currentIndex=0;n();u();ab();ae();aA();R=true}},n=function(){if((ad.children().length%2)!=0){if(ag.closed&&ag.covers){ad.children().last().before(k.blank)}else{ad.children().last().after(k.blank)}}if(ag.closed){a(k.empty).attr({title:ag.closedFrontTitle||"",rel:ag.closedFrontChapter||""}).prependTo(ad);ad.children().last().attr({title:ag.closedBackTitle||"",rel:ag.closedBackChapter||""});ad.append(k.empty)}ag.pageTotal=ad.children().length;ag.startingPageNumber=0;if(ag.direction==ai.rightToLeft){ag.startingPageNumber=ag.pageTotal;if(ag.closed){ag.startingPageNumber-=2}if(ag.covers){ag.startingPageNumber-=2}a(ad.children().get().reverse()).each(function(){a(this).appendTo(ad)})}ad.children().each(function(h){var j=new g(a(this),h,ag);p.push(j)});if(R){u();ab();ae();aA()}},U=function(){ad.find(".b-page").removeClass("b-pN b-p0 b-p1 b-p2 b-p3 b-p4").hide();if(ag.currentIndex-2>=0){ad.find(".b-page-"+(ag.currentIndex-2)).addClass("b-pN").show();ad.find(".b-page-"+(ag.currentIndex-1)).addClass("b-p0").show()}ad.find(".b-page-"+(ag.currentIndex)).addClass("b-p1").show();ad.find(".b-page-"+(ag.currentIndex+1)).addClass("b-p2").show();if(ag.currentIndex+3<=ag.pageTotal){ad.find(".b-page-"+(ag.currentIndex+2)).addClass("b-p3").show();ad.find(".b-page-"+(ag.currentIndex+3)).addClass("b-p4").show()}E=ad.find(".b-pN");ac=ad.find(".b-p0");aa=ad.find(".b-p1");Z=ad.find(".b-p2");Y=ad.find(".b-p3");V=ad.find(".b-p4");aC=ad.find(".b-pN .b-wrap");ak=ad.find(".b-p0 .b-wrap");H=ad.find(".b-p1 .b-wrap");w=ad.find(".b-p2 .b-wrap");d=ad.find(".b-p3 .b-wrap");az=ad.find(".b-p4 .b-wrap");av=ad.find(".b-wrap");if(ag.shadows){ad.find(".b-shadow-f, .b-shadow-b").remove();aB=a('<div class="b-shadow-f"></div>').css({right:0,width:ag.pWidth,height:ag.pHeight}).appendTo(Y);aD=a('<div class="b-shadow-b"></div>').appendTo(ac).css({left:0,width:ag.pWidth,height:ag.pHeight})}},P=function(){c=am=ah=o=false;if(ag.manual&&a.ui){Y.draggable({axis:"x",containment:[Z.offset().left-ag.pWidthH,0,Z.offset().left+ag.pWidth-50,ag.pHeight],drag:function(h,i){ah=true;af=i.originalPosition.left-i.position.left;Y.removeClass("b-grab").addClass("b-grabbing");Y.width(40+(af/2));d.css({left:10+(af/8)});Z.width(ag.pWidth-Y.width()+10);if(ag.shadows){aB.css({right:"-"+(20+af/4)+"px"});if(a.support.opacity){aB.css({opacity:0.5*(af/ag.pWidthH)})}else{aB.css({right:"auto",left:0.1*Y.width()})}}},stop:function(h,i){aw(false);af=i.originalPosition.left-i.position.left;if(af>ag.pWidthH/4){if(ag.shadows&&!a.support.opacity){aB.css({left:"auto"})}aj();Y.removeClass("b-grab b-grabbing")}else{ah=false;Y.removeClass("b-grabbing").addClass("b-grab")}}});ac.draggable({axis:"x",containment:[aa.offset().left+10,0,aa.offset().left+ag.pWidth*0.75,ag.pHeight],drag:function(h,i){o=true;af=i.position.left-i.originalPosition.left;ac.removeClass("b-grab").addClass("b-grabbing");ac.css({left:40+(af)/1.5,width:40+(af)});ak.css({right:10+af/4});aa.css({left:i.position.left+20,width:ag.pWidth-i.position.left-10});H.css({left:-1*(af+30)});if(ag.shadows){if(a.support.opacity){aD.css({opacity:0.5*(af/ag.pWidthH)})}else{aD.css({left:-0.38*ag.pWidth})}}},stop:function(h,i){aw(true);af=i.position.left-i.originalPosition.left;if(af>ag.pWidthH/4){z();ac.removeClass("b-grab b-grabbing")}else{o=false;ac.removeClass("b-grabbing").addClass("b-grab")}}});a(ad).unbind("mousemove mouseout").bind("mousemove",function(h){ax=h.pageX-ad.offset().left;if(ax<50){S(false)}else{if(ax>ag.pWidth-50&&ag.currentIndex==0&&ag.autoCenter&&ag.closed){S(true)}else{if(ax>50&&ax<ag.width-50){aw(false);aw(true)}else{if(ax>ag.width-50){S(true)}}}}}).bind("mouseout",function(){aw(false);aw(true)})}},m=function(){ad.find(".b-shadow-f, .b-shadow-b, .b-p0, .b-p3").css({filter:"",zoom:""});if(ag.manual&&a.ui){ad.find(".b-page").draggable("destroy").removeClass("b-grab b-grabbing")}av.attr("style","");av.css({left:0,width:ag.pWidth-(ag.pagePadding*2)-(ag.pageBorder*2),height:ag.pHeight-(ag.pagePadding*2)-(ag.pageBorder*2),padding:ag.pagePadding});ak.css({right:0,left:"auto"});aa.css({left:0,width:ag.pWidth,height:ag.pHeight});Z.css({left:ag.pWidth,width:ag.pWidth,opacity:1,height:ag.pHeight});if(ag.closed&&ag.autoCenter&&ag.currentIndex>=ag.pageTotal-2){Z.hide()}E.css({left:0,width:ag.pWidth,height:ag.pHeight});ac.css({left:0,width:0,height:ag.pHeight});Y.stop().css({left:ag.pWidth*2,width:0,height:ag.pHeight,paddingLeft:0});V.css({left:ag.pWidth,width:ag.pWidth,height:ag.pHeight});if(ag.closed&&ag.autoCenter&&ag.currentIndex==0){E.css({left:0});aa.css({left:ag.pWidthN});Z.css({left:0});Y.css({left:ag.pWidth});V.css({left:0})}if(ag.closed&&ag.autoCenter&&(ag.currentIndex==0||ag.currentIndex>=ag.pageTotal-2)){if(ag.overlays){v.width("100%")}ad.width(ag.pWidth)}else{if(ag.overlays){v.width("50%")}ad.width(ag.width)}ad.find(".b-page").css({filter:"",zoom:""})},ab=function(){U();m();P()},aj=function(){if(!L){if(an&&ag.currentIndex+2>=ag.pageTotal){x(0)}else{x(ag.currentIndex+2)}}},z=function(){if(!L){if(an&&ag.currentIndex-2<0){x(ag.pageTotal-2)}else{x(ag.currentIndex-2)}}},x=function(h){if(h>ag.currentIndex&&h<ag.pageTotal&&h>=0&&!L){L=true;s=h-ag.currentIndex;ag.currentIndex=h;ag.before.call(this,ag);aA();if(h==ag.pageTotal-2){ae()}J(ag.currentIndex+1,ag);ao(s,true,aB);if(ag.closed&&ag.autoCenter&&h-s==0){Z.stop().animate({width:0,left:ag.pWidth},ag.speed,ag.easing);V.stop().animate({left:ag.pWidth},ag.speed,ag.easing)}else{Z.stop().animate({width:0},ag.speedH,ag.easeIn)}if(ah){Y.stop().animate({left:ag.pWidth/4,width:ag.pWidth*0.75,paddingLeft:ag.shadowBtmWidth},ag.speedH,ag.easeIn).animate({left:0,width:ag.pWidth,paddingLeft:0},ag.speedH)}else{Y.stop().animate({left:ag.pWidthH,width:ag.pWidthH,paddingLeft:ag.shadowBtmWidth},ag.speedH,ag.easeIn).animate({left:0,width:ag.pWidth,paddingLeft:0},ag.speedH)}d.animate({left:ag.shadowBtmWidth},ag.speedH,ag.easeIn).animate({left:0},ag.speedH,ag.easeOut,function(){F()})}else{if(h<ag.currentIndex&&h<ag.pageTotal&&h>=0&&!L){L=true;s=ag.currentIndex-h;ag.currentIndex=h;ag.before.call(this,ag);aA();if(h==0){ae()}J(ag.currentIndex+1,ag);ao(s,false,aD);if(o){aa.animate({left:ag.pWidth,width:0},ag.speed,ag.easing);H.animate({left:ag.pWidthN},ag.speed,ag.easing);if(ag.closed&&ag.autoCenter&&ag.currentIndex==0){ac.animate({left:ag.pWidthH,width:ag.pWidthH},ag.speedH,ag.easeIn).animate({left:0,width:ag.pWidth},ag.speedH,ag.easeOut);Z.stop().animate({left:0},ag.speed,ag.easing)}else{ac.animate({left:ag.pWidth,width:ag.pWidth},ag.speed,ag.easing)}ak.animate({right:0},ag.speed,ag.easing,function(){F()})}else{aa.animate({left:ag.pWidth,width:0},ag.speed,ag.easing);H.animate({left:ag.pWidthN},ag.speed,ag.easing);if(ag.closed&&ag.autoCenter&&ag.currentIndex==0){ac.animate({left:ag.pWidthH,width:ag.pWidthH},ag.speedH,ag.easeIn).animate({left:0,width:ag.pWidth},ag.speedH,ag.easeOut);Z.stop().animate({left:0},ag.speed,ag.easing)}else{ac.animate({left:ag.pWidthH,width:ag.pWidthH},ag.speedH,ag.easeIn).animate({left:ag.pWidth,width:ag.pWidth},ag.speedH,ag.easeOut)}ak.animate({right:ag.shadowBtmWidth},ag.speedH,ag.easeIn).animate({right:0},ag.speedH,ag.easeOut,function(){F()})}}}},S=function(h){if(h){if(!L&&!c&&!am&&!ah&&ag.currentIndex+2<=ag.pageTotal-2){Z.stop().animate({width:ag.pWidth-40},500,ag.easing);Y.addClass("b-grab");if(ag.closed&&ag.autoCenter&&ag.currentIndex==0){Y.stop().animate({left:ag.pWidth-50,width:40},500,ag.easing)}else{Y.stop().animate({left:ag.width-50,width:40},500,ag.easing)}d.stop().animate({left:10},500,ag.easing);if(ag.shadows&&!a.support.opacity){aB.css({right:"auto",left:"-40%"})}c=true}}else{if(!L&&!am&&!c&&!o&&ag.currentIndex-2>=0){aa.stop().animate({left:10,width:ag.pWidth-10},400,ag.easing);ac.addClass("b-grab");H.stop().animate({left:"-10px"},400,ag.easing);ac.stop().animate({left:10,width:40},400,ag.easing);ak.stop().animate({right:10},400,ag.easing);if(ag.shadows&&!a.support.opacity){aD.css({left:-0.38*ag.pWidth})}am=true}}},aw=function(h){if(h){if(!L&&c&&!ah&&ag.currentIndex+2<=ag.pageTotal-2){Z.stop().animate({width:ag.pWidth},500,ag.easing);if(ag.closed&&ag.autoCenter&&ag.currentIndex==0){Y.stop().animate({left:ag.pWidth,width:0},500,ag.easing)}else{Y.stop().animate({left:ag.width,width:0},500,ag.easing)}d.stop().animate({left:0},500,ag.easing);if(ag.shadows&&!a.support.opacity){aB.css({left:"auto"})}c=false}}else{if(!L&&am&&!o&&ag.currentIndex-2>=0){aa.stop().animate({left:0,width:ag.pWidth},400,ag.easing);H.stop().animate({left:0},400,ag.easing);ac.stop().animate({left:0,width:0},400,ag.easing);ak.stop().animate({right:0},400,ag.easing);am=false}}},ao=function(i,h,j){if(h&&i>2){ad.find(".b-p3, .b-p4").removeClass("b-p3 b-p4").hide();ad.find(".b-page-"+ag.currentIndex).addClass("b-p3").show().stop().css({left:ag.pWidth*2,width:0,height:ag.pHeight,paddingLeft:0});ad.find(".b-page-"+(ag.currentIndex+1)).addClass("b-p4").show().css({left:ag.pWidth,width:ag.pWidth,height:ag.pHeight});ad.find(".b-page-"+ag.currentIndex+" .b-wrap").show().css({width:ag.pWidth-(ag.pagePadding*2),height:ag.pHeight-(ag.pagePadding*2),padding:ag.pagePadding});ad.find(".b-page-"+(ag.currentIndex+1)+" .b-wrap").show().css({width:ag.pWidth-(ag.pagePadding*2),height:ag.pHeight-(ag.pagePadding*2),padding:ag.pagePadding});Y=ad.find(".b-p3");V=ad.find(".b-p4");d=ad.find(".b-p3 .b-wrap");az=ad.find(".b-p4 .b-wrap");if(ag.closed&&ag.autoCenter&&ag.currentIndex-i==0){Y.css({left:ag.pWidth});V.css({left:0})}if(c){Y.css({left:ag.width-40,width:20,"padding-left":10})}if(ag.shadows){ad.find(".b-shadow-f").remove();aB=a('<div class="b-shadow-f"></div>').css({right:0,width:ag.pWidth,height:ag.pHeight}).appendTo(Y);j=aB}}else{if(!h&&i>2){ad.find(".b-pN, .b-p0").removeClass("b-pN b-p0").hide();ad.find(".b-page-"+ag.currentIndex).addClass("b-pN").show().css({left:0,width:ag.pWidth,height:ag.pHeight});ad.find(".b-page-"+(ag.currentIndex+1)).addClass("b-p0").show().css({left:0,width:0,height:ag.pHeight});ad.find(".b-page-"+ag.currentIndex+" .b-wrap").show().css({width:ag.pWidth-(ag.pagePadding*2),height:ag.pHeight-(ag.pagePadding*2),padding:ag.pagePadding});ad.find(".b-page-"+(ag.currentIndex+1)+" .b-wrap").show().css({width:ag.pWidth-(ag.pagePadding*2),height:ag.pHeight-(ag.pagePadding*2),padding:ag.pagePadding});E=ad.find(".b-pN");ac=ad.find(".b-p0");aC=ad.find(".b-pN .b-wrap");ak=ad.find(".b-p0 .b-wrap");if(ag.closed&&ag.autoCenter){E.css({left:0})}ak.css({right:0,left:"auto"});if(am){ac.css({left:10,width:40});ak.css({right:10})}if(ag.shadows){ad.find(".b-shadow-b, .b-shadow-f").remove();aD=a('<div class="b-shadow-b"></div>').appendTo(ac).css({left:0,width:ag.pWidth,height:ag.pHeight});j=aD}}}if(ag.closed){if(!h&&ag.currentIndex==0){E.hide()}else{if(!h){E.show()}}if(h&&ag.currentIndex>=ag.pageTotal-2){V.hide()}else{if(h){V.show()}}}if(ag.shadows){if(a.support.opacity){j.animate({opacity:1},ag.speedH,ag.easeIn).animate({opacity:0},ag.speedH,ag.easeOut)}else{if(h){j.animate({right:ag.shadowTopFwdWidth},ag.speed,ag.easeIn)}else{j.animate({left:ag.shadowTopBackWidth},ag.speed,ag.easeIn)}}}if(ag.closed&&ag.autoCenter){if(ag.currentIndex==0){Y.hide();V.hide();ad.animate({width:ag.pWidth},ag.speed,ag.easing)}else{if(ag.currentIndex>=ag.pageTotal-2){ac.hide();E.hide();ad.animate({width:ag.pWidth},ag.speed,ag.easing)}else{ad.animate({width:ag.width},ag.speed,ag.easing)}}}},F=function(){ab();aA();ag.after.call(this,ag);ae();L=false;if(ag.auto&&ag.delay){clearTimeout(Q);Q=setTimeout(function(){if(ag.direction==ai.leftToRight){aj()}else{z()}},ag.delay)}},u=function(){ag.pageTotal=ad.children().length;if(!R){if(!ag.width){ag.width=ad.width()}else{if(typeof ag.width=="string"&&ag.width.indexOf("%")!=-1){ag.wPercent=true;ag.wOrig=ag.width;ag.width=(ag.width.replace("%","")/100)*parseFloat(ad.parent().css("width"))}}if(!ag.height){ag.height=ad.height()}else{if(typeof ag.height=="string"&&ag.height.indexOf("%")!=-1){ag.hPercent=true;ag.hOrig=ag.height;ag.height=(ag.height.replace("%","")/100)*parseFloat(ad.parent().css("height"))}}ad.width(ag.width);ad.height(ag.height);ag.pWidth=ag.width/2;ag.pWidthN="-"+(ag.pWidth)+"px";ag.pWidthH=ag.pWidth/2;ag.pHeight=ag.height;ag.speedH=ag.speed/2;ag.currentIndex=0;if(ag.direction==ai.leftToRight){ag.currentIndex=0}else{if(ag.direction==ai.rightToLeft){ag.currentIndex=ag.pageTotal-2}}if(!isNaN(ag.startingPage)&&ag.startingPage<=ag.pageTotal&&ag.startingPage>0){if((ag.startingPage%2)!=0){ag.startingPage--}ag.currentIndex=ag.startingPage}if(ag.closed&&ag.autoCenter){if(ag.currentIndex==0){ad.width(ag.pWidth)}else{if(ag.currentIndex>=ag.pageTotal-2){ad.width(ag.pWidth)}}}if(ag.name){document.title=ag.name}else{ag.name=document.title}if(ag.shadows){ag.shadowTopFwdWidth="-"+ag.shadowTopFwdWidth+"px";ag.shadowTopBackWidth="-"+ag.shadowTopBackWidth+"px"}}if(ag.menu){q=a(ag.menu).addClass("b-menu");if(ag.pageSelector){var aJ=a('<div class="b-selector b-selector-page"><span class="b-current">'+(ag.currentIndex+1)+" - "+(ag.currentIndex+2)+"</span></div>").appendTo(q);var aH=a("<ul></ul>").appendTo(aJ).empty().css("height","auto");for(I=0;I<ag.pageTotal;I+=2){G=I;var aN=(G+1)+"-"+(G+2);if(ag.closed){G--;if(I==0){aN="1"}else{if(I==ag.pageTotal-2){aN=ag.pageTotal-2}else{aN=(G+1)+"-"+(G+2)}}if(ag.covers){G--;if(I==0){aN=""}else{if(I==ag.pageTotal-2){aN=""}else{aN=(G+1)+"-"+(G+2)}}}}if(I==0){aJ.find(".b-current").text(aN)}var aL=p[I].title;if(aL==""){aL=p[I+1].title}if(ag.direction==ai.rightToLeft){aL=p[Math.abs(I-ag.pageTotal)-1].title;if(aL==""){aL=p[Math.abs(I-ag.pageTotal)-2].title}}var aG=a('<li><a href="#'+W+(I+1)+'" id="selector-page-'+I+'"><span class="b-text">'+aL+'</span><span class="b-num">'+aN+"</span></a></li>").appendTo(aH);if(!ag.hash){aG.find("a").click(function(){if(ag.direction==ai.rightToLeft){aJ.find(".b-current").text(a(this).find(".b-num").text());x(Math.abs(parseInt(a(this).attr("id").replace("selector-page-",""))-ag.pageTotal)-2)}else{x(parseInt(a(this).attr("id").replace("selector-page-","")))}return false})}}var i=aH.height();aH.css({height:0,"padding-bottom":0});aJ.unbind("hover").hover(function(){aH.stop().animate({height:i,paddingBottom:10},500)},function(){aH.stop().animate({height:0,paddingBottom:0},500)})}if(ag.chapterSelector){var h=p[ag.currentIndex].chapter;if(h==""){h=p[ag.currentIndex+1].chapter}var aM=a('<div class="b-selector b-selector-chapter"><span class="b-current">'+h+"</span></div>").appendTo(q);var j=a("<ul></ul>").appendTo(aM).empty().css("height","auto");for(I=0;I<ag.pageTotal;I+=1){var aI;if(p[I].chapter!=""&&typeof p[I].chapter!="undefined"){if(ag.direction==ai.rightToLeft){G=I;if(G%2!=0){G--}aM.find(".b-current").text(p[I].chapter);aI=a('<li><a href="#'+W+(G+1)+'" id="selector-page-'+(G)+'"><span class="b-text">'+p[I].chapter+"</span></a></li>").prependTo(j)}else{aI=a('<li><a href="#'+W+(I+1)+'" id="selector-page-'+I+'"><span class="b-text">'+p[I].chapter+"</span></a></li>").appendTo(j)}if(!ag.hash){aI.find("a").click(function(){if(ag.direction==ai.rightToLeft){aM.find(".b-current").text(a(this).find(".b-text").text());x(Math.abs(parseInt(a(this).attr("id").replace("selector-page-",""))-ag.pageTotal)-2)}else{x(parseInt(a(this).attr("id").replace("selector-page-","")))}return false})}}}var aK=j.height();j.css({height:0,"padding-bottom":0});aM.unbind("hover").hover(function(){j.stop().animate({height:aK,paddingBottom:10},500)},function(){j.stop().animate({height:0,paddingBottom:0},500)})}}ap=a('<div class="b-controls"></div>').appendTo(ad);if(!R){if(ag.manual&&a.ui){ag.overlays=false}if(ag.next){B=a(ag.next);B.click(function(aP){aP.preventDefault();aj()})}if(ag.prev){A=a(ag.prev);A.click(function(aP){aP.preventDefault();z()})}}if(ag.overlays){at=a('<div class="b-overlay b-overlay-prev b-prev" title="'+ag.previousControlTitle+'"></div>').appendTo(ap);au=a('<div class="b-overlay b-overlay-next b-next" title="'+ag.nextControlTitle+'"></div>').appendTo(ap);v=ad.find(".b-overlay");if(a.browser.msie){v.css({background:"#fff",filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0) !important"})}}if(ag.tabs){aq=a('<div class="b-tab b-tab-prev b-prev" title="'+ag.previousControlTitle+'">'+ag.previousControlText+"</div>").appendTo(ap);ar=a('<div class="b-tab b-tab-next b-next" title="'+ag.nextControlTitle+'">'+ag.nextControlText+"</div>").appendTo(ap);O=ad.find(".b-tab");if(ag.tabWidth){O.width(ag.tabWidth)}if(ag.tabHeight){O.height(ag.tabHeight)}O.css({top:"-"+ar.outerHeight()+"px"});ad.css({marginTop:ar.outerHeight()});if(ag.direction==ai.rightToLeft){ar.html(ag.previousControlText).attr("title",ag.previousControlTitle);aq.html(ag.nextControlText).attr("title",ag.nextControlTitle)}}else{ad.css({marginTop:0})}if(ag.arrows){C=a('<div class="b-arrow b-arrow-prev b-prev" title="'+ag.previousControlTitle+'"><div>'+ag.previousControlText+"</div></div>").appendTo(ap);D=a('<div class="b-arrow b-arrow-next b-next" title="'+ag.nextControlTitle+'"><div>'+ag.nextControlText+"</div></div>").appendTo(ap);r=ad.find(".b-arrow");if(ag.direction==ai.rightToLeft){D.html("<div>"+ag.previousControlText+"</div>").attr("title",ag.previousControlTitle);C.html("<div>"+ag.nextControlText+"</div>").attr("title",ag.nextControlTitle)}}f=ap.find(".b-next");e=ap.find(".b-prev");f.bind("click",function(aP){aP.preventDefault();aj()});e.bind("click",function(aP){aP.preventDefault();z()});if(ag.overlays&&ag.hovers){f.unbind("mouseover mouseout").bind("mouseover",function(){S(true)}).bind("mouseout",function(){aw(true)});e.unbind("mouseover mouseout").bind("mouseover",function(){S(false)}).bind("mouseout",function(){aw(false)})}if(ag.arrows){if(ag.arrowsHide){if(a.support.opacity){f.hover(function(){D.find("div").stop().fadeTo("fast",1)},function(){D.find("div").stop().fadeTo("fast",0)});e.hover(function(){C.find("div").stop().fadeTo("fast",1)},function(){C.find("div").stop().fadeTo("fast",0)})}else{f.hover(function(){D.find("div").show()},function(){D.find("div").hide()});e.hover(function(){C.find("div").show()},function(){C.find("div").hide()})}}else{D.find("div").show();C.find("div").show()}}if(!R){if(ag.keyboard){a(document).keyup(function(aP){if(aP.keyCode==37&&ag.keyboard){z()}else{if(aP.keyCode==39&&ag.keyboard){aj()}}})}if(ag.hash){l();clearInterval(K);K=setInterval(function(){X()},250)}if(ag.wPercent||ag.hPercent){a(window).resize(function(){T()})}if(ag.auto&&ag.delay){clearTimeout(Q);Q=setTimeout(function(){if(ag.direction==ai.leftToRight){aj()}else{z()}},ag.delay);an=true;if(ag.pause){var aO=a(ag.pause);aO.click(function(aP){aP.preventDefault();if(an){clearTimeout(Q);an=false}})}if(ag.play){var aF=a(ag.play);aF.click(function(aP){aP.preventDefault();if(!an){clearTimeout(Q);Q=setTimeout(function(){if(ag.direction==ai.leftToRight){aj()}else{z()}},ag.delay);an=true}})}}}},T=function(){if(ag.wPercent){ag.width=(ag.wOrig.replace("%","")/100)*parseFloat(ad.parent().css("width"));ad.width(ag.width);ag.pWidth=ag.width/2;ag.pWidthN="-"+(ag.pWidth)+"px";ag.pWidthH=ag.pWidth/2}if(ag.hPercent){ag.height=(ag.hOrig.replace("%","")/100)*parseFloat(ad.parent().css("height"));ad.height(ag.height);ag.pHeight=ag.height}m()},ae=function(){if(ag.overlays||ag.tabs||ag.arrows){if(a.support.opacity){if(ag.currentIndex>=2&&ag.currentIndex!=0){e.fadeIn("fast").css("cursor",ag.cursor)}else{e.fadeOut("fast").css("cursor","default")}if(ag.currentIndex<ag.pageTotal-2){f.fadeIn("fast").css("cursor",ag.cursor)}else{f.fadeOut("fast").css("cursor","default")}}else{if(ag.currentIndex>=2&&ag.currentIndex!=0){e.show().css("cursor",ag.cursor)}else{e.hide().css("cursor","default")}if(ag.currentIndex<ag.pageTotal-2){f.show().css("cursor",ag.cursor)}else{f.hide().css("cursor","default")}}}},aA=function(){if(ag.pageSelector){var h="";if(ag.direction==ai.rightToLeft){h=(Math.abs(ag.currentIndex-ag.pageTotal)-1)+" - "+((Math.abs(ag.currentIndex-ag.pageTotal)));if(ag.closed){if(ag.currentIndex==ag.pageTotal-2){h="1"}else{if(ag.currentIndex==0){h=ag.pageTotal-2}else{h=(Math.abs(ag.currentIndex-ag.pageTotal)-2)+" - "+((Math.abs(ag.currentIndex-ag.pageTotal)-1))}}if(ag.covers){if(ag.currentIndex==ag.pageTotal-2){h=""}else{if(ag.currentIndex==0){h=""}else{h=(Math.abs(ag.currentIndex-ag.pageTotal)-3)+" - "+((Math.abs(ag.currentIndex-ag.pageTotal)-2))}}}}}else{h=(ag.currentIndex+1)+" - "+(ag.currentIndex+2);if(ag.closed){if(ag.currentIndex==0){h="1"}else{if(ag.currentIndex==ag.pageTotal-2){h=ag.pageTotal-2}else{h=(ag.currentIndex)+"-"+(ag.currentIndex+1)}}if(ag.covers){if(ag.currentIndex==0){h=""}else{if(ag.currentIndex==ag.pageTotal-2){h=""}else{h=(ag.currentIndex-1)+"-"+(ag.currentIndex)}}}}}a(ag.menu+" .b-selector-page .b-current").text(h)}if(ag.chapterSelector){if(p[ag.currentIndex].chapter!=""){a(ag.menu+" .b-selector-chapter .b-current").text(p[ag.currentIndex].chapter)}else{if(p[ag.currentIndex+1].chapter!=""){a(ag.menu+" .b-selector-chapter .b-current").text(p[ag.currentIndex+1].chapter)}}if(ag.direction==ai.rightToLeft&&p[ag.currentIndex+1].chapter!=""){a(ag.menu+" .b-selector-chapter .b-current").text(p[ag.currentIndex+1].chapter)}else{if(p[ag.currentIndex]!=""){a(ag.menu+" .b-selector-chapter .b-current").text(p[ag.currentIndex].chapter)}}}},l=function(){M=y();if(!isNaN(M)&&M<=ag.pageTotal-1&&M>=0&&M!=""){if((M%2)!=0){M--}ag.currentIndex=M}else{J(ag.currentIndex+1,ag)}N=M},X=function(){M=y();if(!isNaN(M)&&M<=ag.pageTotal-1&&M>=0){if(M!=ag.currentIndex&&M.toString()!=N){if((M%2)!=0){M--}document.title=ag.name+ag.hashTitleText+(M+1);if(!L){x(M);N=M}}}},y=function(){var i=window.location.hash.split("/");if(i.length>1){var h=parseInt(i[2])-1;if(ag.direction==ai.rightToLeft){h=Math.abs(h+1-ag.pageTotal)}return h}else{return""}},J=function(i,h){if(h.hash){if(h.direction==ai.rightToLeft){i=Math.abs(i-h.pageTotal)}window.location.hash=W+i}},t=function(h,i){if(h=="start"){h=0}else{if(h=="end"){h=ad.data("total")}else{if(typeof h=="number"){if(h<0||h>ad.data("total")){return}}else{if(typeof h=="undefined"){return}}}}if(typeof i=="undefined"||i==""){return}ad.find(".b-wrap").unwrap();ad.find(".b-wrap").children().unwrap();ad.find(".b-counter, .b-page-blank, .b-page-empty, .b-shadow-f, .b-shadow-b").remove();ap.remove();ap=null;if(ag.menu){ag.menu.removeClass("b-menu").children().remove()}if(ag.direction==ai.rightToLeft){a(ad.children().get().reverse()).each(function(){a(this).appendTo(ad)})}if(ag.closed&&ag.covers&&h==ad.data("total")){ad.children(":eq("+(h-1)+")").before(i)}else{if(ag.closed&&ag.covers&&h==0){ad.children(":eq("+h+")").after(i)}else{if(h==ad.data("total")){ad.children(":eq("+(h-1)+")").after(i)}else{ad.children(":eq("+h+")").before(i)}}}ad.data("total",ad.children().length);n()};return{init:al,next:aj,prev:z,goToPage:function(h){if(h%2!=0){h-=1}if(ag.direction==ai.rightToLeft){h=Math.abs(h-ag.pageTotal)-2}x(h)},addPage:t,options:ag}}a.fn.booklet.defaults={name:null,width:600,height:400,speed:1000,direction:"LTR",startingPage:0,easing:"easeInOutQuad",easeIn:"easeInQuad",easeOut:"easeOutQuad",closed:false,closedFrontTitle:"Beginning",closedFrontChapter:"Beginning of Book",closedBackTitle:"End",closedBackChapter:"End of Book",covers:false,autoCenter:false,pagePadding:10,pageNumbers:true,pageBorder:0,manual:true,hovers:true,overlays:true,tabs:false,tabWidth:60,tabHeight:20,nextControlText:"Next",previousControlText:"Previous",nextControlTitle:"Next Page",previousControlTitle:"Previous Page",arrows:false,arrowsHide:false,cursor:"pointer",hash:false,hashTitleText:" - Page ",keyboard:true,next:null,prev:null,auto:false,delay:5000,pause:null,play:null,menu:null,pageSelector:false,chapterSelector:false,shadows:true,shadowTopFwdWidth:166,shadowTopBackWidth:166,shadowBtmWidth:50,before:function(){},after:function(){}}})(jQuery);